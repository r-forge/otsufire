% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/3.calculate_polygon_metrics.R
\name{calculate_polygon_metrics}
\alias{calculate_polygon_metrics}
\title{Calculate Geometric Metrics and Filter Fire Polygons (Batch Mode)}
\arguments{
\item{shapefile_paths}{Character vector of paths to input polygon shapefiles.}

\item{output_dir}{Directory to save the output shapefiles. If `NULL`, outputs are saved next to input files.}

\item{area_min_ha}{Minimum area in hectares (`area_ha`). Set to `NULL` to disable. Default: 10.}

\item{bbox_h_min}{Minimum height of axis-aligned bounding box (`bbox_hy`). Default: 630.}

\item{mnbbx_wd_min}{Minimum width of rotated bounding box (`mnbbx_wd`). Default: 800.}

\item{p_w_ratio_min}{Minimum perimeter-to-width ratio (`p_w_ratio`). Default: 4.0.}

\item{h_w_ratio_min}{Minimum height-to-width ratio (`h_w_ratio`). Default: 0.35.}

\item{output_format}{Character. Output format for saved files: `"shp"` (default) or `"geojson"`.}

\item{filter_logic}{Logical combination of filters: `"AND"` (default) requires all filters to be met, `"OR"` passes polygons meeting any filter.}

\item{dissolve}{Logical. If TRUE, dissolve adjacent polygons into contiguous shapes before computing metrics. Default: TRUE.}

\item{overlay_polygons}{Optional. `sf` object or path to shapefile to be joined by spatial intersection. If `NULL`, no spatial join is performed.}
}
\value{
A named list with one entry per input shapefile. Each entry contains:
\describe{
  \item{metrics}{Path to shapefile with all polygons and computed metrics.}
  \item{filtered}{Path to shapefile with only filtered polygons.}
  \item{joined_metrics}{Path to joined shapefile: original polygons + metrics + event ID.}
  \item{joined_filtered}{Path to joined filtered shapefile: original polygons + metrics + event ID.}
  \item{polygons_all}{`sf` object with all input polygons and metrics.}
  \item{polygons_filtered}{`sf` object with only polygons that passed filters.}
}
}
\description{
This function calculates geometric descriptors for fire-affected polygons from
a list of input shapefiles. Metrics include area, perimeter, bounding box dimensions,
and elongation. Optionally, spatial filters can be applied to retain only polygons
that meet certain geometric criteria.

For each input shapefile, the function saves:
- A shapefile with all polygons and computed metrics.
- A filtered shapefile with only polygons passing all active filters.
- Optionally, joined versions of the above with attributes from the original input shapefile.

If the input fire events are subdivided by CORINE or ECOREGION classes, adjacent geometries can be dissolved before metric calculation to reconstruct contiguous burned areas.
In that case, a numeric `burned_id` is assigned to each disjoint polygon in the dissolved geometry. This ID is retained in the spatial joins to allow tracking the disaggregated components of each event.

## Metrics calculated per polygon:
- `area_ha`: Area in hectares.
- `bbox_wx`: Width of the axis-aligned bounding box (east-west).
- `bbox_hy`: Height of the axis-aligned bounding box (north-south).
- `perim_m`: Polygon perimeter in meters.
- `p_w_ratio`: Perimeter-to-width ratio (`perim_m / bbox_wx`), proxy for complexity.
- `h_w_ratio`: Height-to-width ratio (`bbox_hy / bbox_wx`), proxy for anisotropy.
- `burned_id`: Integer identifier (1 to N) assigned to each polygon in the dissolved output.

## Filtering behavior:
All filter thresholds are optional. If a parameter is `NULL`, its corresponding filter is skipped.
A polygon must satisfy **all active filters** to appear in the filtered output, unless `filter_logic = "OR"` is used.

## Spatial Join (optional):
If the input shapefiles contain attribute data (e.g., CORINE codes, ecoregion classes), these attributes
are preserved in the output by performing a spatial join **from the original shapefile to the metrics output**.
- `joined_metrics`: polygons from the original shapefile with appended metric fields and `event_id`.
- `joined_filtered`: filtered version of the above.
}
\examples{
\dontrun{
# Load example fire polygons and apply geometric filtering
burned_dir <- system.file("extdata", package = "OtsuFire")
burned_files <- list.files(
  burned_dir, pattern = glob2rx("burned_areas_*.shp$"), full.names = TRUE
)

# Define filtering thresholds
result_list <- calculate_polygon_metrics(
  shapefile_paths = burned_files,
  output_dir = burned_dir,
  area_min_ha = 10,
  bbox_h_min = 630,
  mnbbx_wd_min = 800,
  p_w_ratio_min = 4.0,
  h_w_ratio_min = 0.35,
  output_format = "geojson",
  filter_logic = "AND",
  dissolve = TRUE
)

# Access filtered and joined outputs
print(result_list[[1]]$filtered)
print(result_list[[1]]$joined_filtered)
}

}
